import{_ as K,q as S,a as k,c as F,b as m,d as a,w as o,k as v,t as B,h as O,v as R,f as r,x as j,e as c}from"./index.BCp--acD.js";import{a as _}from"./app.CusJVMsI.js";import"./index.D9AvatZ4.js";const E={class:"upload-container"},M={class:"upload-form"},T={key:0,class:"upload-progress"},$={__name:"Upload",setup(h){const w=R(),U=S(),l=j({name:"",versionName:"",category:"",tags:"",description:"",updateLog:"",images:[],videos:[]}),f=c(null),V=c([]),b=c([]),y=c(!1),u=c(0),A=c(!1),x=d=>{f.value=d.raw,console.log("APK 文件选择:",d.name)},D=(d,e)=>{V.value=e.map(n=>n.raw),console.log("图片文件选择:",e.length,"张")},N=(d,e)=>{b.value=e.map(n=>n.raw),console.log("视频文件选择:",e.length,"个")},I=async()=>{if(!f.value){alert("请选择 APK 文件");return}if(!l.name||!l.versionName||!l.description){alert("请填写必要的应用信息");return}y.value=!0,u.value=10;try{const d=new FormData;d.append("apk",f.value),u.value=30;const e=await _.uploadApk(d);if(u.value=60,e.success){const n=e.app.id;for(const t of V.value){const s=new FormData;s.append("image",t),await _.uploadAppImage(n,s)}for(const t of b.value){const s=new FormData;s.append("video",t),await _.uploadAppVideo(n,s)}const g={name:l.name,category:l.category,tags:l.tags.split(",").map(t=>t.trim()),description:l.description,updateLog:l.updateLog?[{date:new Date().toISOString(),content:l.updateLog}]:[]};await _.updateAppInfo(n,g),u.value=100,alert(e.message),w.push(`/app/${n}`)}else alert("上传失败: "+e.message)}catch(d){console.error("上传失败:",d),alert("上传失败，请重试")}finally{y.value=!1,u.value=0}},P=()=>{Object.assign(l,{name:"",versionName:"",category:"",tags:"",description:"",updateLog:"",images:[],videos:[]}),f.value=null,V.value=[],b.value=[]};return U.getIsLoggedIn||w.push("/login"),(d,e)=>{const n=r("el-button"),g=r("el-upload"),t=r("el-form-item"),s=r("el-input"),i=r("el-option"),L=r("el-select"),q=r("el-form"),C=r("el-progress");return k(),F("div",E,[e[14]||(e[14]=m("h1",{class:"page-title"},"上传应用",-1)),m("div",M,[a(t,{label:"APK 文件",required:""},{default:o(()=>[a(g,{class:"apk-uploader",action:"#","auto-upload":!1,"on-change":x,"show-file-list":!0,accept:".apk",limit:1},{tip:o(()=>[...e[7]||(e[7]=[m("div",{class:"el-upload__tip"}," 请选择 Android 应用 APK 文件，系统会自动识别应用信息 ",-1)])]),default:o(()=>[a(n,{type:"primary"},{default:o(()=>[...e[6]||(e[6]=[v("选择 APK 文件",-1)])]),_:1})]),_:1})]),_:1}),a(q,{model:l,"label-width":"100px"},{default:o(()=>[a(t,{label:"应用名称",required:""},{default:o(()=>[a(s,{modelValue:l.name,"onUpdate:modelValue":e[0]||(e[0]=p=>l.name=p),placeholder:"请输入应用名称"},null,8,["modelValue"])]),_:1}),a(t,{label:"版本号",required:""},{default:o(()=>[a(s,{modelValue:l.versionName,"onUpdate:modelValue":e[1]||(e[1]=p=>l.versionName=p),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1}),a(t,{label:"应用分类"},{default:o(()=>[a(L,{modelValue:l.category,"onUpdate:modelValue":e[2]||(e[2]=p=>l.category=p),placeholder:"请选择应用分类"},{default:o(()=>[a(i,{label:"游戏",value:"game"}),a(i,{label:"工具",value:"tool"}),a(i,{label:"社交",value:"social"}),a(i,{label:"教育",value:"education"}),a(i,{label:"娱乐",value:"entertainment"}),a(i,{label:"金融",value:"finance"}),a(i,{label:"健康",value:"health"})]),_:1},8,["modelValue"])]),_:1}),a(t,{label:"应用标签"},{default:o(()=>[a(s,{modelValue:l.tags,"onUpdate:modelValue":e[3]||(e[3]=p=>l.tags=p),placeholder:"请输入标签，用逗号分隔"},null,8,["modelValue"])]),_:1}),a(t,{label:"应用描述",required:""},{default:o(()=>[a(s,{modelValue:l.description,"onUpdate:modelValue":e[4]||(e[4]=p=>l.description=p),type:"textarea",rows:5,placeholder:"请输入应用描述"},null,8,["modelValue"])]),_:1}),a(t,{label:"宣传图片"},{default:o(()=>[a(g,{class:"image-uploader",action:"#","auto-upload":!1,"on-change":D,"show-file-list":!0,accept:"image/*",multiple:!0},{tip:o(()=>[...e[9]||(e[9]=[m("div",{class:"el-upload__tip"}," 请选择宣传图片，支持多张上传 ",-1)])]),default:o(()=>[a(n,{type:"primary"},{default:o(()=>[...e[8]||(e[8]=[v("选择图片",-1)])]),_:1})]),_:1})]),_:1}),a(t,{label:"宣传视频"},{default:o(()=>[a(g,{class:"video-uploader",action:"#","auto-upload":!1,"on-change":N,"show-file-list":!0,accept:"video/mp4",limit:1},{tip:o(()=>[...e[11]||(e[11]=[m("div",{class:"el-upload__tip"}," 请选择 MP4 格式的宣传视频 ",-1)])]),default:o(()=>[a(n,{type:"primary"},{default:o(()=>[...e[10]||(e[10]=[v("选择视频",-1)])]),_:1})]),_:1})]),_:1}),a(t,{label:"更新日志"},{default:o(()=>[a(s,{modelValue:l.updateLog,"onUpdate:modelValue":e[5]||(e[5]=p=>l.updateLog=p),type:"textarea",rows:3,placeholder:"请输入更新内容"},null,8,["modelValue"])]),_:1}),a(t,null,{default:o(()=>[a(n,{type:"primary",onClick:I,loading:y.value},{default:o(()=>[v(B(A.value?"更新应用":"上传应用"),1)]),_:1},8,["loading"]),a(n,{onClick:P},{default:o(()=>[...e[12]||(e[12]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),u.value>0&&u.value<100?(k(),F("div",T,[a(C,{percentage:u.value},null,8,["percentage"]),e[13]||(e[13]=m("p",null,"上传中，请稍候...",-1))])):O("",!0)])}}},J=K($,[["__scopeId","data-v-006a55d8"]]);export{J as default};
