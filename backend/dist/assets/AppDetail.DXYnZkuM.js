import{_ as T,o as j,a as l,c as n,F as w,r as k,h as u,b as t,u as c,t as i,d as r,w as _,j as G,k as y,l as H,s as K,m as O,p as q,e as v,f as b}from"./index.DF3behv_.js";import{a as B}from"./app.B2tPatVd.js";import{a as J}from"./ad.dXGxTie5.js";import{A}from"./index.CnCq3VPH.js";const Q={class:"app-detail-container"},W={key:0,class:"detail-ad"},X=["href"],Y=["src","alt"],Z={key:1,class:"ad-video"},ee=["src"],te=["href"],se={key:1,class:"app-info-section"},ae={class:"app-header"},oe={class:"app-icon"},le=["src","alt"],ne={class:"app-basic-info"},ie={class:"app-name"},re={class:"app-meta"},ce={class:"app-version"},ue={class:"app-size"},de={class:"app-rating"},pe={class:"app-description-short"},ve={class:"app-actions"},_e=["href"],me=["href"],he={key:2,class:"app-media-section"},fe={class:"media-grid"},ge=["src","alt"],we=["src"],ke={key:3,class:"app-description-section"},ye={class:"app-description"},Ae={key:4,class:"app-update-section"},Ve={class:"update-log"},xe={class:"log-date"},$e={class:"log-content"},Ne={key:5,class:"app-reviews-section"},be={class:"reviews-list"},Be={class:"review-header"},Ce={class:"reviewer"},De={class:"review-rating"},Ue={class:"review-date"},Fe={class:"review-content"},Re={key:0,class:"empty-reviews"},Se={class:"review-form"},Ie={key:6,class:"loading-state"},Le={key:7,class:"error-state"},ze={__name:"AppDetail",setup(Me){const C=q().params.id,e=v(null),V=v(!0),x=v(null),D=v([]),$=v(5),f=v(""),R=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":a<1024*1024*1024?(a/(1024*1024)).toFixed(1)+" MB":(a/(1024*1024*1024)).toFixed(1)+" GB",F=async()=>{try{V.value=!0,x.value=null;const a=await B.getAppDetail(C);e.value=a}catch(a){x.value="获取应用详情失败",console.error("获取应用详情失败:",a)}finally{V.value=!1}},S=async()=>{try{const a=await J.getAdsByPosition("detail");D.value=a}catch(a){console.error("获取详情页广告失败:",a)}},I=()=>{console.log("应用下载:",e.value.name)},L=()=>{console.log("应用更新:",e.value.name)},N=v(!1),U=v(null),z=async()=>{try{console.log("开始检查更新:",C);const a=await B.checkVersion(C);console.log("版本检查返回:",a),a&&a.latestVersion&&(U.value=a.latestVersion,e.value&&e.value.versionName&&(N.value=M(U.value,e.value.versionName),console.log("版本比较结果:",{current:e.value.versionName,latest:U.value,hasUpdate:N.value})))}catch(a){console.error("检查更新失败:",a),N.value=!0}},M=(a,s)=>{const d=a.split(".").map(Number),m=s.split(".").map(Number);for(let h=0;h<Math.max(d.length,m.length);h++){const g=d[h]||0,o=m[h]||0;if(g>o)return!0;if(g<o)return!1}return!1},E=()=>{navigator.share?navigator.share({title:e.value.name,text:e.value.description||"来 SmartAppHub 下载这个应用吧！",url:window.location.href}):navigator.clipboard.writeText(window.location.href).then(()=>{alert("链接已复制到剪贴板")})},P=()=>{if(!f.value.trim()){alert("请输入评论内容");return}const a={rating:$.value,content:f.value,date:new Date().toISOString()};e.value.reviews||(e.value.reviews=[]),e.value.reviews.unshift(a);const s=e.value.reviews.reduce((d,m)=>d+m.rating,0);e.value.rating=(s/e.value.reviews.length).toFixed(1),$.value=5,f.value="",alert("评论提交成功！")};return j(async()=>{await F(),S(),e.value&&await z()}),(a,s)=>{const d=b("el-icon"),m=b("el-rate"),h=b("el-input"),g=b("el-button");return l(),n("div",Q,[D.value.length>0?(l(),n("section",W,[(l(!0),n(w,null,k(D.value,o=>(l(),n("div",{key:o.id,class:"ad-item"},[o.type==="image"?(l(),n("a",{key:0,href:o.link,target:"_blank",class:"ad-link"},[t("img",{src:`${c(A).replace("/api","")}${o.mediaUrl}`,alt:o.title,class:"ad-image"},null,8,Y)],8,X)):o.type==="video"?(l(),n("div",Z,[t("video",{src:`${c(A).replace("/api","")}${o.mediaUrl}`,autoplay:"",loop:"",muted:"",playsinline:""}," 您的浏览器不支持视频播放 ",8,ee),t("a",{href:o.link,target:"_blank",class:"ad-overlay"},i(o.title),9,te)])):u("",!0)]))),128))])):u("",!0),e.value?(l(),n("section",se,[t("div",ae,[t("div",oe,[t("img",{src:`${c(A).replace("/api","")}${e.value.icon}`,alt:e.value.name},null,8,le)]),t("div",ne,[t("h1",ie,i(e.value.name),1),t("div",re,[t("span",ce,"v"+i(e.value.versionName),1),t("span",ue,i(R(e.value.size)),1),t("span",de,i(e.value.rating||0)+" ★",1)]),t("p",pe,i(e.value.description||"暂无描述"),1),t("div",ve,[t("a",{href:c(B).downloadApp(e.value.id),class:"download-btn",onClick:I},[r(d,null,{default:_(()=>[r(c(G))]),_:1}),s[2]||(s[2]=y(" 下载 ",-1))],8,_e),N.value?(l(),n("a",{key:0,href:c(B).downloadApp(e.value.id),class:"update-btn",onClick:L},[r(d,null,{default:_(()=>[r(c(H))]),_:1}),s[3]||(s[3]=y(" 更新 ",-1))],8,me)):u("",!0),t("button",{class:"share-btn",onClick:E},[r(d,null,{default:_(()=>[r(c(K))]),_:1}),s[4]||(s[4]=y(" 分享 ",-1))])])])])])):u("",!0),e.value&&(e.value.images.length>0||e.value.videos.length>0)?(l(),n("section",he,[s[5]||(s[5]=t("h2",{class:"section-title"},"应用截图",-1)),t("div",fe,[(l(!0),n(w,null,k(e.value.images,(o,p)=>(l(),n("div",{key:p,class:"media-item"},[t("img",{src:`${c(A).replace("/api","")}${o}`,alt:`${e.value.name} 截图 ${p+1}`,class:"media-image"},null,8,ge)]))),128)),(l(!0),n(w,null,k(e.value.videos,(o,p)=>(l(),n("div",{key:p,class:"media-item video-item"},[t("video",{src:`${c(A).replace("/api","")}${o}`,controls:"",class:"media-video"}," 您的浏览器不支持视频播放 ",8,we)]))),128))])])):u("",!0),e.value?(l(),n("section",ke,[s[6]||(s[6]=t("h2",{class:"section-title"},"应用介绍",-1)),t("div",ye,i(e.value.description||"暂无详细介绍"),1)])):u("",!0),e.value&&e.value.updateLog&&e.value.updateLog.length>0?(l(),n("section",Ae,[s[7]||(s[7]=t("h2",{class:"section-title"},"更新日志",-1)),t("div",Ve,[(l(!0),n(w,null,k(e.value.updateLog,(o,p)=>(l(),n("div",{key:p,class:"log-item"},[t("div",xe,i(o.date||e.value.updatedAt),1),t("div",$e,i(o.content),1)]))),128))])])):u("",!0),e.value?(l(),n("section",Ne,[s[11]||(s[11]=t("h2",{class:"section-title"},"用户评论",-1)),t("div",be,[(l(!0),n(w,null,k(e.value.reviews,(o,p)=>(l(),n("div",{key:p,class:"review-item"},[t("div",Be,[t("span",Ce,"用户"+i(p+1),1),t("span",De,i(o.rating)+" ★",1),t("span",Ue,i(o.date),1)]),t("div",Fe,i(o.content),1)]))),128)),e.value.reviews.length===0?(l(),n("div",Re,[...s[8]||(s[8]=[t("p",null,"暂无评论，快来抢沙发吧！",-1)])])):u("",!0)]),t("div",Se,[s[10]||(s[10]=t("h3",null,"发表评论",-1)),r(m,{modelValue:$.value,"onUpdate:modelValue":s[0]||(s[0]=o=>$.value=o),max:5},null,8,["modelValue"]),r(h,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=o=>f.value=o),type:"textarea",rows:3,placeholder:"请输入您的评论..."},null,8,["modelValue"]),r(g,{type:"primary",onClick:P},{default:_(()=>[...s[9]||(s[9]=[y("提交评论",-1)])]),_:1})])])):u("",!0),V.value?(l(),n("div",Ie,[r(d,{class:"loading-icon"},{default:_(()=>[r(c(V))]),_:1}),s[12]||(s[12]=t("p",null,"加载中...",-1))])):u("",!0),x.value?(l(),n("div",Le,[r(d,{class:"error-icon"},{default:_(()=>[r(c(O))]),_:1}),t("p",null,i(x.value),1),r(g,{type:"primary",onClick:F},{default:_(()=>[...s[13]||(s[13]=[y("重试",-1)])]),_:1})])):u("",!0)])}}},He=T(ze,[["__scopeId","data-v-21432194"]]);export{He as default};
