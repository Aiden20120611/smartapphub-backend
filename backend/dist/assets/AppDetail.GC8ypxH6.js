import{_ as M,o as T,a as o,c as l,F as m,r as f,h as d,b as e,t as i,u as p,d as r,w as v,j,k as g,l as E,s as G,m as H,p as K,e as _,f as A}from"./index.BCp--acD.js";import{a as C}from"./app.CusJVMsI.js";import{a as O}from"./ad.CS18M8yU.js";import"./index.D9AvatZ4.js";const P={class:"app-detail-container"},q={key:0,class:"detail-ad"},J=["href"],Q=["src","alt"],W={key:1,class:"ad-video"},X=["src"],Y=["href"],Z={key:1,class:"app-info-section"},ee={class:"app-header"},te={class:"app-icon"},se=["src","alt"],ae={class:"app-basic-info"},oe={class:"app-name"},le={class:"app-meta"},ne={class:"app-version"},ie={class:"app-size"},re={class:"app-rating"},de={class:"app-description-short"},ce={class:"app-actions"},ue=["href"],pe=["href"],ve={key:2,class:"app-media-section"},_e={class:"media-grid"},he=["src","alt"],me=["src"],fe={key:3,class:"app-description-section"},ge={class:"app-description"},we={key:4,class:"app-update-section"},ke={class:"update-log"},ye={class:"log-date"},Ae={class:"log-content"},xe={key:5,class:"app-reviews-section"},Ve={class:"reviews-list"},Ce={class:"review-header"},De={class:"reviewer"},be={class:"review-rating"},Be={class:"review-date"},Fe={class:"review-content"},Ue={key:0,class:"empty-reviews"},$e={class:"review-form"},Ne={key:6,class:"loading-state"},Re={key:7,class:"error-state"},Se={__name:"AppDetail",setup(Le){const F=K().params.id,t=_(null),w=_(!0),k=_(null),x=_([]),y=_(5),h=_(""),U=n=>n<1024?n+" B":n<1024*1024?(n/1024).toFixed(1)+" KB":n<1024*1024*1024?(n/(1024*1024)).toFixed(1)+" MB":(n/(1024*1024*1024)).toFixed(1)+" GB",D=async()=>{try{w.value=!0,k.value=null;const n=await C.getAppDetail(F);t.value=n}catch(n){k.value="获取应用详情失败",console.error("获取应用详情失败:",n)}finally{w.value=!1}},$=async()=>{try{const n=await O.getAdsByPosition("detail");x.value=n}catch(n){console.error("获取详情页广告失败:",n)}},N=()=>{console.log("应用下载:",t.value.name)},R=()=>{console.log("应用更新:",t.value.name)},b=_(!1),S=()=>{b.value=!0},L=()=>{navigator.share?navigator.share({title:t.value.name,text:t.value.description||"来 SmartAppHub 下载这个应用吧！",url:window.location.href}):navigator.clipboard.writeText(window.location.href).then(()=>{alert("链接已复制到剪贴板")})},z=()=>{if(!h.value.trim()){alert("请输入评论内容");return}const n={rating:y.value,content:h.value,date:new Date().toISOString()};t.value.reviews||(t.value.reviews=[]),t.value.reviews.unshift(n);const s=t.value.reviews.reduce((u,V)=>u+V.rating,0);t.value.rating=(s/t.value.reviews.length).toFixed(1),y.value=5,h.value="",alert("评论提交成功！")};return T(()=>{D(),$(),S()}),(n,s)=>{const u=A("el-icon"),V=A("el-rate"),I=A("el-input"),B=A("el-button");return o(),l("div",P,[x.value.length>0?(o(),l("section",q,[(o(!0),l(m,null,f(x.value,a=>(o(),l("div",{key:a.id,class:"ad-item"},[a.type==="image"?(o(),l("a",{key:0,href:a.link,target:"_blank",class:"ad-link"},[e("img",{src:`http://localhost:3001${a.mediaUrl}`,alt:a.title,class:"ad-image"},null,8,Q)],8,J)):a.type==="video"?(o(),l("div",W,[e("video",{src:`http://localhost:3001${a.mediaUrl}`,autoplay:"",loop:"",muted:"",playsinline:""}," 您的浏览器不支持视频播放 ",8,X),e("a",{href:a.link,target:"_blank",class:"ad-overlay"},i(a.title),9,Y)])):d("",!0)]))),128))])):d("",!0),t.value?(o(),l("section",Z,[e("div",ee,[e("div",te,[e("img",{src:`http://localhost:3001${t.value.icon}`,alt:t.value.name},null,8,se)]),e("div",ae,[e("h1",oe,i(t.value.name),1),e("div",le,[e("span",ne,"v"+i(t.value.versionName),1),e("span",ie,i(U(t.value.size)),1),e("span",re,i(t.value.rating||0)+" ★",1)]),e("p",de,i(t.value.description||"暂无描述"),1),e("div",ce,[e("a",{href:p(C).downloadApp(t.value.id),class:"download-btn",onClick:N},[r(u,null,{default:v(()=>[r(p(j))]),_:1}),s[2]||(s[2]=g(" 下载 ",-1))],8,ue),b.value?(o(),l("a",{key:0,href:p(C).downloadApp(t.value.id),class:"update-btn",onClick:R},[r(u,null,{default:v(()=>[r(p(E))]),_:1}),s[3]||(s[3]=g(" 更新 ",-1))],8,pe)):d("",!0),e("button",{class:"share-btn",onClick:L},[r(u,null,{default:v(()=>[r(p(G))]),_:1}),s[4]||(s[4]=g(" 分享 ",-1))])])])])])):d("",!0),t.value&&(t.value.images.length>0||t.value.videos.length>0)?(o(),l("section",ve,[s[5]||(s[5]=e("h2",{class:"section-title"},"应用截图",-1)),e("div",_e,[(o(!0),l(m,null,f(t.value.images,(a,c)=>(o(),l("div",{key:c,class:"media-item"},[e("img",{src:`http://localhost:3001${a}`,alt:`${t.value.name} 截图 ${c+1}`,class:"media-image"},null,8,he)]))),128)),(o(!0),l(m,null,f(t.value.videos,(a,c)=>(o(),l("div",{key:c,class:"media-item video-item"},[e("video",{src:`http://localhost:3001${a}`,controls:"",class:"media-video"}," 您的浏览器不支持视频播放 ",8,me)]))),128))])])):d("",!0),t.value?(o(),l("section",fe,[s[6]||(s[6]=e("h2",{class:"section-title"},"应用介绍",-1)),e("div",ge,i(t.value.description||"暂无详细介绍"),1)])):d("",!0),t.value&&t.value.updateLog&&t.value.updateLog.length>0?(o(),l("section",we,[s[7]||(s[7]=e("h2",{class:"section-title"},"更新日志",-1)),e("div",ke,[(o(!0),l(m,null,f(t.value.updateLog,(a,c)=>(o(),l("div",{key:c,class:"log-item"},[e("div",ye,i(a.date||t.value.updatedAt),1),e("div",Ae,i(a.content),1)]))),128))])])):d("",!0),t.value?(o(),l("section",xe,[s[11]||(s[11]=e("h2",{class:"section-title"},"用户评论",-1)),e("div",Ve,[(o(!0),l(m,null,f(t.value.reviews,(a,c)=>(o(),l("div",{key:c,class:"review-item"},[e("div",Ce,[e("span",De,"用户"+i(c+1),1),e("span",be,i(a.rating)+" ★",1),e("span",Be,i(a.date),1)]),e("div",Fe,i(a.content),1)]))),128)),t.value.reviews.length===0?(o(),l("div",Ue,[...s[8]||(s[8]=[e("p",null,"暂无评论，快来抢沙发吧！",-1)])])):d("",!0)]),e("div",$e,[s[10]||(s[10]=e("h3",null,"发表评论",-1)),r(V,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=a=>y.value=a),max:5},null,8,["modelValue"]),r(I,{modelValue:h.value,"onUpdate:modelValue":s[1]||(s[1]=a=>h.value=a),type:"textarea",rows:3,placeholder:"请输入您的评论..."},null,8,["modelValue"]),r(B,{type:"primary",onClick:z},{default:v(()=>[...s[9]||(s[9]=[g("提交评论",-1)])]),_:1})])])):d("",!0),w.value?(o(),l("div",Ne,[r(u,{class:"loading-icon"},{default:v(()=>[r(p(w))]),_:1}),s[12]||(s[12]=e("p",null,"加载中...",-1))])):d("",!0),k.value?(o(),l("div",Re,[r(u,{class:"error-icon"},{default:v(()=>[r(p(H))]),_:1}),e("p",null,i(k.value),1),r(B,{type:"primary",onClick:D},{default:v(()=>[...s[13]||(s[13]=[g("重试",-1)])]),_:1})])):d("",!0)])}}},Ee=M(Se,[["__scopeId","data-v-4dfabed4"]]);export{Ee as default};
