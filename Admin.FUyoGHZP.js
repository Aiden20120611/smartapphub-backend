import{_ as Z,q as ee,o as le,a as M,c as te,b,d as l,w as t,k as n,t as ae,g as oe,h as re,v as de,f as s,e as f,x as S}from"./index.DF3behv_.js";import{u as q}from"./user.DWHd_fX-.js";import{a as F}from"./ad.dXGxTie5.js";import{a as T}from"./app.B2tPatVd.js";import"./index.CnCq3VPH.js";const se={class:"admin-container"},ne={class:"admin-section"},ie={class:"admin-section"},ue={class:"admin-section"},pe={class:"dialog-footer"},me={class:"dialog-footer"},fe={__name:"Admin",setup(be){const E=de(),$=ee(),x=f("users"),D=f([]),R=f([]),I=f([]),c=f(!1),p=S({username:"",password:"",role:"user"}),h={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"blur"}]},_=f(null),w=f(!1),r=S({title:"",type:"image",position:"home",link:"",order:1,mediaFile:null}),j={title:[{required:!0,message:"请输入广告标题",trigger:"blur"}],type:[{required:!0,message:"请选择广告类型",trigger:"blur"}],position:[{required:!0,message:"请选择广告位置",trigger:"blur"}],link:[{required:!0,message:"请输入广告链接",trigger:"blur"}],order:[{required:!0,message:"请输入排序序号",trigger:"blur"}]},g=f(null),v=async()=>{try{const o=await q.getAllUsers();D.value=o}catch(o){console.error("获取用户列表失败:",o)}},V=async()=>{try{const o=await F.getAdList();R.value=o}catch(o){console.error("获取广告列表失败:",o)}},B=async()=>{try{const o=await T.getAppList();I.value=o}catch(o){console.error("获取应用列表失败:",o)}},z=async()=>{_.value&&_.value.validate(async o=>{if(o)try{await q.addUser(p),c.value=!1,await v(),alert("用户添加成功")}catch(e){console.error("添加用户失败:",e),alert("添加用户失败，请重试")}})},G=async o=>{if(confirm("确定要删除这个用户吗？"))try{await q.deleteUser(o),await v(),alert("用户删除成功")}catch(e){console.error("删除用户失败:",e),alert("删除用户失败，请重试")}},H=o=>{r.mediaFile=o.raw,console.log("媒体文件选择:",o.name)},J=async()=>{g.value&&g.value.validate(async o=>{if(o)try{const e=new FormData;e.append("title",r.title),e.append("type",r.type),e.append("position",r.position),e.append("link",r.link),e.append("order",r.order),r.mediaFile&&e.append("media",r.mediaFile),await F.createAd(e),w.value=!1,await V(),alert("广告添加成功")}catch(e){console.error("添加广告失败:",e),alert("添加广告失败，请重试")}})},K=o=>{console.log("编辑广告:",o)},O=async o=>{if(confirm("确定要删除这个广告吗？"))try{await F.deleteAd(o),await V(),alert("广告删除成功")}catch(e){console.error("删除广告失败:",e),alert("删除广告失败，请重试")}},P=async o=>{if(confirm("确定要删除这个应用吗？"))try{await T.deleteApp(o),await B(),alert("应用删除成功")}catch(e){console.error("删除应用失败:",e),alert("删除应用失败，请重试")}};return(!$.getIsLoggedIn||$.getRole!=="superadmin")&&E.push("/login"),le(()=>{v(),V(),B()}),(o,e)=>{const i=s("el-button"),d=s("el-table-column"),k=s("el-table"),A=s("el-tab-pane"),Q=s("el-tag"),W=s("router-link"),X=s("el-tabs"),y=s("el-input"),u=s("el-form-item"),m=s("el-option"),U=s("el-select"),N=s("el-form"),L=s("el-dialog"),Y=s("el-upload");return M(),te("div",se,[e[27]||(e[27]=b("h1",{class:"page-title"},"管理员后台",-1)),l(X,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=a=>x.value=a)},{default:t(()=>[l(A,{label:"用户管理",name:"users"},{default:t(()=>[b("div",ne,[l(i,{type:"primary",onClick:e[0]||(e[0]=a=>c.value=!0)},{default:t(()=>[...e[15]||(e[15]=[n("添加用户",-1)])]),_:1}),l(k,{data:D.value,style:{width:"100%"},class:"user-table"},{default:t(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{prop:"username",label:"用户名"}),l(d,{prop:"role",label:"角色"}),l(d,{prop:"createdAt",label:"创建时间",width:"180"}),l(d,{label:"操作",width:"150"},{default:t(a=>[l(i,{type:"danger",onClick:C=>G(a.row.id),disabled:a.row.id==="1"},{default:t(()=>[...e[16]||(e[16]=[n("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])])]),_:1}),l(A,{label:"广告管理",name:"ads"},{default:t(()=>[b("div",ie,[l(i,{type:"primary",onClick:e[1]||(e[1]=a=>w.value=!0)},{default:t(()=>[...e[17]||(e[17]=[n("添加广告",-1)])]),_:1}),l(k,{data:R.value,style:{width:"100%"},class:"ad-table"},{default:t(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{prop:"title",label:"标题"}),l(d,{prop:"type",label:"类型",width:"100"}),l(d,{prop:"position",label:"位置",width:"120"}),l(d,{prop:"status",label:"状态",width:"100"},{default:t(a=>[l(Q,{type:a.row.status==="active"?"success":"danger"},{default:t(()=>[n(ae(a.row.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"操作",width:"200"},{default:t(a=>[l(i,{type:"primary",onClick:C=>K(a.row)},{default:t(()=>[...e[18]||(e[18]=[n("编辑",-1)])]),_:1},8,["onClick"]),l(i,{type:"danger",onClick:C=>O(a.row.id)},{default:t(()=>[...e[19]||(e[19]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),l(A,{label:"应用管理",name:"apps"},{default:t(()=>[b("div",ue,[l(k,{data:I.value,style:{width:"100%"},class:"app-table"},{default:t(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{prop:"name",label:"应用名称"}),l(d,{prop:"versionName",label:"版本",width:"100"}),l(d,{prop:"downloadCount",label:"下载量",width:"100"}),l(d,{prop:"uploadedBy",label:"上传者",width:"120"}),l(d,{prop:"updatedAt",label:"更新时间",width:"180"}),l(d,{label:"操作",width:"200"},{default:t(a=>[l(W,{to:`/app/${a.row.id}`,class:"view-btn"},{default:t(()=>[l(i,{type:"primary"},{default:t(()=>[...e[20]||(e[20]=[n("查看",-1)])]),_:1})]),_:1},8,["to"]),l(i,{type:"danger",onClick:C=>P(a.row.id)},{default:t(()=>[...e[21]||(e[21]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a),title:"添加用户"},{footer:t(()=>[b("span",pe,[l(i,{onClick:e[6]||(e[6]=a=>c.value=!1)},{default:t(()=>[...e[22]||(e[22]=[n("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:z},{default:t(()=>[...e[23]||(e[23]=[n("确定",-1)])]),_:1})])]),default:t(()=>[l(N,{model:p,rules:h,ref_key:"userFormRef",ref:_,"label-width":"80px"},{default:t(()=>[l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(y,{modelValue:p.username,"onUpdate:modelValue":e[3]||(e[3]=a=>p.username=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(u,{label:"密码",prop:"password"},{default:t(()=>[l(y,{modelValue:p.password,"onUpdate:modelValue":e[4]||(e[4]=a=>p.password=a),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(u,{label:"角色",prop:"role"},{default:t(()=>[l(U,{modelValue:p.role,"onUpdate:modelValue":e[5]||(e[5]=a=>p.role=a),placeholder:"请选择角色"},{default:t(()=>[l(m,{label:"应用管理员",value:"appmanager"}),l(m,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(L,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=a=>w.value=a),title:"添加广告"},{footer:t(()=>[b("span",me,[l(i,{onClick:e[13]||(e[13]=a=>w.value=!1)},{default:t(()=>[...e[25]||(e[25]=[n("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:J},{default:t(()=>[...e[26]||(e[26]=[n("确定",-1)])]),_:1})])]),default:t(()=>[l(N,{model:r,rules:j,ref_key:"adFormRef",ref:g,"label-width":"80px"},{default:t(()=>[l(u,{label:"标题",prop:"title"},{default:t(()=>[l(y,{modelValue:r.title,"onUpdate:modelValue":e[8]||(e[8]=a=>r.title=a),placeholder:"请输入广告标题"},null,8,["modelValue"])]),_:1}),l(u,{label:"类型",prop:"type"},{default:t(()=>[l(U,{modelValue:r.type,"onUpdate:modelValue":e[9]||(e[9]=a=>r.type=a),placeholder:"请选择广告类型"},{default:t(()=>[l(m,{label:"图片",value:"image"}),l(m,{label:"视频",value:"video"}),l(m,{label:"网页",value:"web"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"位置",prop:"position"},{default:t(()=>[l(U,{modelValue:r.position,"onUpdate:modelValue":e[10]||(e[10]=a=>r.position=a),placeholder:"请选择广告位置"},{default:t(()=>[l(m,{label:"首页轮播",value:"home"}),l(m,{label:"分类页横幅",value:"category"}),l(m,{label:"详情页插屏",value:"detail"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"链接",prop:"link"},{default:t(()=>[l(y,{modelValue:r.link,"onUpdate:modelValue":e[11]||(e[11]=a=>r.link=a),placeholder:"请输入广告链接"},null,8,["modelValue"])]),_:1}),l(u,{label:"排序",prop:"order"},{default:t(()=>[l(y,{modelValue:r.order,"onUpdate:modelValue":e[12]||(e[12]=a=>r.order=a),modelModifiers:{number:!0},placeholder:"请输入排序序号",type:"number"},null,8,["modelValue"])]),_:1}),r.type!=="web"?(M(),oe(u,{key:0,label:"媒体文件"},{default:t(()=>[l(Y,{class:"media-uploader",action:"#","auto-upload":!1,"on-change":H,"show-file-list":!0,accept:r.type==="image"?"image/*":"video/mp4"},{default:t(()=>[l(i,{type:"primary"},{default:t(()=>[...e[24]||(e[24]=[n("选择文件",-1)])]),_:1})]),_:1},8,["accept"])]),_:1})):re("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ve=Z(fe,[["__scopeId","data-v-fc4fac53"]]);export{ve as default};
